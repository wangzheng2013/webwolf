<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>werewolfkill</title>
    <script src = "https://cdn.wilddog.com/js/client/current/wilddog.js" ></script>
    <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
</head>
<body>
    <div align="center">欢迎来到狼人杀</div>
    <div align="center">
        <span>请输入用户名</span>
        <input type="text" id="usernameInput">
        <button type="button" onclick="logIn()">提交</button>
    </div>

    <div align="center" id="tip">

    </div>
    <div align="center">
        <textarea style="width:400px; height: 100px" id="mytextarea"></textarea>
    </div>
    <div align="center">
        <span>发送消息</span>
        <input type="text" id="messageInput">
        <button type="button" onclick="sendMessage()">提交</button>
    </div>

    <div align="center" id="userlist">
        <span>当前在线用户数</span>
    </div>

    <div align="center">
        <button type="button" onclick="startGame()">开始游戏</button>
    </div>
</body>
<script>
    var ref = new Wilddog("https://werewolfkill.wilddogio.com/");
    var user_totalnumber = 0;
    var isStart = false;

    ref.child("user").on("value", function(data) {
        console.log(data.val());
        var user = data.val();
        user_totalnumber = Object.getOwnPropertyNames(user).length;
        if(data.val() != null)
        {
            $("#user_n").remove();
            $("#userlist").append('<span id="user_n">'+ user_totalnumber +'</span>');
        }
    });
    var chat = '';
    ref.child("message").on("value",function(data){
        console.log(data.val());
        if(data.val() != null)
        {
            chat += data.val().word + "\r\n";
            $("#mytextarea").text(chat);
        }
    });

    function logIn(){
        var username = $('#usernameInput').val();
        $('#tip').text(username + ' 请等待游戏开始');
        ref.child("user/" + username).set({
            "name" : username
        });
    }
    function sendMessage(){
        var word = $('#messageInput').val();
        ref.child("message").set({
            "word" : word
        });
    }

    function startGame(){
        isStart = true;

    }
</script>
</html>